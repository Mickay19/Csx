<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSX - Weapon Analytics Platform</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- –®–∞–ø–∫–∞ —Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π -->
        <div class="auth-header">
            <div id="authSection">
                <button onclick="showAuthModal()" class="auth-btn">–í–æ–π—Ç–∏</button>
                <span id="userInfo" style="display: none;"></span>
            </div>
        </div>

        <header>
            <h1>CSX Weapon Analytics</h1>
            <p>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –≤–æ–æ—Ä—É–∂–µ–Ω–∏—è</p>
        </header>

        <main class="main-menu">
            <div class="button-grid">
                <a href="damage-calculator.html" class="menu-button">
                    <h2>üìä –ê–Ω–∞–ª–∏–∑ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h2>
                    <p>–†–∞—Å—á–µ—Ç –±–∞–ª–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏ –≤—Ä–µ–º–µ–Ω–∏ –Ω–µ–π—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏</p>
                </a>

                <a href="comparison.html" class="menu-button">
                    <h2>üîÑ –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –æ—Ä—É–∂–∏—è</h2>
                    <p>–ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –¥–≤—É—Ö –º–æ–¥–µ–ª–µ–π —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏</p>
                </a>

                <div class="menu-button" onclick="showSavedBuilds()">
                    <h2>üíæ –ú–æ–∏ —Å–±–æ—Ä–∫–∏</h2>
                    <p>–°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∞–Ω–∞–ª–∏–∑–∞</p>
                </div>

                <div class="menu-button" onclick="showSavedComparisons()">
                    <h2>üìà –ò—Å—Ç–æ—Ä–∏—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–π</h2>
                    <p>–ü—Ä–æ—Å–º–æ—Ç—Ä —Ä–∞–Ω–µ–µ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã—Ö –∞–Ω–∞–ª–∏–∑–æ–≤</p>
                </div>
            </div>
        </main>

        <footer>
            <p>CSX Weapon Analytics Platform ¬© 2024 | Backend: <span id="backendStatus">‚ùå –ù–µ –¥–æ—Å—Ç—É–ø–µ–Ω</span></p>
        </footer>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <h3>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è CSX</h3>
            <div class="form-group">
                <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="loginUsername" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è">
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="loginPassword" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <button onclick="login()" class="btn-primary">–í–æ–π—Ç–∏</button>
            <button onclick="showRegister()" class="btn-secondary">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
            <p id="authError" class="error-message"></p>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <h3>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ CSX</h3>
            <div class="form-group">
                <label>–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                <input type="text" id="regUsername" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –∏–º—è">
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="regEmail" placeholder="–í–≤–µ–¥–∏—Ç–µ email">
            </div>
            <div class="form-group">
                <label>–ü–∞—Ä–æ–ª—å:</label>
                <input type="password" id="regPassword" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
            </div>
            <button onclick="register()" class="btn-primary">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
            <button onclick="showLogin()" class="btn-secondary">–ù–∞–∑–∞–¥ –∫ –≤—Ö–æ–¥—É</button>
            <p id="registerError" class="error-message"></p>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        // –§—É–Ω–∫—Ü–∏–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        function showAuthModal() {
            document.getElementById('authModal').style.display = 'block';
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('authError').style.display = 'none';
        }

        function showRegister() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('registerModal').style.display = 'block';
            document.getElementById('registerError').style.display = 'none';
        }

        function showLogin() {
            document.getElementById('authModal').style.display = 'block';
            document.getElementById('registerModal').style.display = 'none';
            document.getElementById('authError').style.display = 'none';
        }

        function hideModals() {
            document.getElementById('authModal').style.display = 'none';
            document.getElementById('registerModal').style.display = 'none';
        }

        // –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
        async function login() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('authError');

            if (!username || !password) {
                errorElement.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                errorElement.style.display = 'block';
                return;
            }

            try {
                await authSystem.login(username, password);
                hideModals();
                alert('–£—Å–ø–µ—à–Ω—ã–π –≤—Ö–æ–¥!');
            } catch (error) {
                errorElement.textContent = error.message;
                errorElement.style.display = 'block';
            }
        }

        // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
        async function register() {
            const username = document.getElementById('regUsername').value;
            const email = document.getElementById('regEmail').value;
            const password = document.getElementById('regPassword').value;
            const errorElement = document.getElementById('registerError');

            if (!username || !email || !password) {
                errorElement.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                errorElement.style.display = 'block';
                return;
            }

            try {
                await authSystem.register({ username, email, password });
                hideModals();
                alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞!');
            } catch (error) {
                errorElement.textContent = error.message;
                errorElement.style.display = 'block';
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        function showSavedBuilds() {
            if (!authSystem.checkAuth()) {
                alert('–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º —Å–±–æ—Ä–∫–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                showAuthModal();
                return;
            }
            window.location.href = 'saved-builds.html';
        }

        function showSavedComparisons() {
            if (!authSystem.checkAuth()) {
                alert('–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∏—Å—Ç–æ—Ä–∏–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É');
                showAuthModal();
                return;
            }
            window.location.href = 'saved-comparisons.html';
        }

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –±—ç–∫–µ–Ω–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        async function checkBackend() {
            try {
                const health = await authSystem.checkServerHealth();
                document.getElementById('backendStatus').innerHTML = '‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç';
                document.getElementById('backendStatus').style.color = '#4cc9f0';
            } catch (error) {
                document.getElementById('backendStatus').innerHTML = '‚ùå –û—à–∏–±–∫–∞';
                document.getElementById('backendStatus').style.color = '#f72585';
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            checkBackend();
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
            window.onclick = function(event) {
                const authModal = document.getElementById('authModal');
                const registerModal = document.getElementById('registerModal');
                
                if (event.target === authModal) {
                    authModal.style.display = 'none';
                }
                if (event.target === registerModal) {
                    registerModal.style.display = 'none';
                }
            }
        });
    </script>
</body>
</html>